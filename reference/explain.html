<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Explain the output of machine learning models with more accurately estimated Shapley values — explain • shapr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Explain the output of machine learning models with more accurately estimated Shapley values — explain" />
<meta property="og:description" content="Explain the output of machine learning models with more accurately estimated Shapley values" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shapr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/understanding_shapr.html">Explaining individual machine learning predictions with Shapley values</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Manual</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/NorskRegnesentral/shapr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Explain the output of machine learning models with more accurately estimated Shapley values</h1>
    <small class="dont-index">Source: <a href='https://github.com/NorskRegnesentral/shapr/blob/master/R/explanation.R'><code>R/explanation.R</code></a></small>
    <div class="hidden name"><code>explain.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Explain the output of machine learning models with more accurately estimated Shapley values</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>explain</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>explainer</span>, <span class='va'>approach</span>, <span class='va'>prediction_zero</span>, n_samples <span class='op'>=</span> <span class='fl'>1000</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for independence</span>
<span class='fu'>explain</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>explainer</span>, <span class='va'>approach</span>, <span class='va'>prediction_zero</span>, n_samples <span class='op'>=</span> <span class='fl'>1000</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for empirical</span>
<span class='fu'>explain</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>explainer</span>,
  <span class='va'>approach</span>,
  <span class='va'>prediction_zero</span>,
  n_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  w_threshold <span class='op'>=</span> <span class='fl'>0.95</span>,
  type <span class='op'>=</span> <span class='st'>"fixed_sigma"</span>,
  fixed_sigma_vec <span class='op'>=</span> <span class='fl'>0.1</span>,
  n_samples_aicc <span class='op'>=</span> <span class='fl'>1000</span>,
  eval_max_aicc <span class='op'>=</span> <span class='fl'>20</span>,
  start_aicc <span class='op'>=</span> <span class='fl'>0.1</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for gaussian</span>
<span class='fu'>explain</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>explainer</span>,
  <span class='va'>approach</span>,
  <span class='va'>prediction_zero</span>,
  n_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  mu <span class='op'>=</span> <span class='cn'>NULL</span>,
  cov_mat <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for copula</span>
<span class='fu'>explain</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>explainer</span>, <span class='va'>approach</span>, <span class='va'>prediction_zero</span>, n_samples <span class='op'>=</span> <span class='fl'>1000</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for ctree</span>
<span class='fu'>explain</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>explainer</span>,
  <span class='va'>approach</span>,
  <span class='va'>prediction_zero</span>,
  n_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  mincriterion <span class='op'>=</span> <span class='fl'>0.95</span>,
  minsplit <span class='op'>=</span> <span class='fl'>20</span>,
  minbucket <span class='op'>=</span> <span class='fl'>7</span>,
  sample <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for combined</span>
<span class='fu'>explain</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>explainer</span>,
  <span class='va'>approach</span>,
  <span class='va'>prediction_zero</span>,
  n_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  mu <span class='op'>=</span> <span class='cn'>NULL</span>,
  cov_mat <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for ctree_comb_mincrit</span>
<span class='fu'>explain</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>explainer</span>, <span class='va'>approach</span>, <span class='va'>prediction_zero</span>, <span class='va'>n_samples</span>, <span class='va'>mincriterion</span>, <span class='va'>...</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A matrix or data.frame. Contains the the features, whose
predictions ought to be explained (test data).</p></td>
    </tr>
    <tr>
      <th>explainer</th>
      <td><p>An <code>explainer</code> object to use for explaining the observations.
See <code><a href='shapr.html'>shapr</a></code>.</p></td>
    </tr>
    <tr>
      <th>approach</th>
      <td><p>Character vector of length <code>1</code> or <code>n_features</code>.
<code>n_features</code> equals the total number of features in the model. All elements should,
either be <code>"gaussian"</code>, <code>"copula"</code>, <code>"empirical"</code>, <code>"ctree"</code>, or <code>"independence"</code>.
See details for more information.</p></td>
    </tr>
    <tr>
      <th>prediction_zero</th>
      <td><p>Numeric. The prediction value for unseen data, typically equal to the mean of
the response.</p></td>
    </tr>
    <tr>
      <th>n_samples</th>
      <td><p>Positive integer. Indicating the maximum number of samples to use in the
Monte Carlo integration for every conditional expectation. See also details.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='prepare_data.html'>prepare_data</a></code></p></td>
    </tr>
    <tr>
      <th>w_threshold</th>
      <td><p>Numeric vector of length 1, with <code>0 &lt; w_threshold &lt;= 1</code> representing the minimum proportion
of the total empirical weight that data samples should use. If e.g. <code>w_threshold = .8</code> we will choose the
<code>K</code> samples with the largest weight so that the sum of the weights accounts for 80% of the total weight.
<code>w_threshold</code> is the \(\eta\) parameter in equation (15) of Aas et al (2021).</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Character. Should be equal to either <code>"independence"</code>,
<code>"fixed_sigma"</code>, <code>"AICc_each_k"</code> or <code>"AICc_full"</code>.</p></td>
    </tr>
    <tr>
      <th>fixed_sigma_vec</th>
      <td><p>Numeric. Represents the kernel bandwidth. Note that this argument is only
applicable when <code>approach = "empirical"</code>, and <code>type = "fixed_sigma"</code></p></td>
    </tr>
    <tr>
      <th>n_samples_aicc</th>
      <td><p>Positive integer. Number of samples to consider in AICc optimization.
Note that this argument is only applicable when <code>approach = "empirical"</code>, and <code>type</code>
is either equal to <code>"AICc_each_k"</code> or <code>"AICc_full"</code></p></td>
    </tr>
    <tr>
      <th>eval_max_aicc</th>
      <td><p>Positive integer. Maximum number of iterations when
optimizing the AICc. Note that this argument is only applicable when
<code>approach = "empirical"</code>, and <code>type</code> is either equal to
<code>"AICc_each_k"</code> or <code>"AICc_full"</code></p></td>
    </tr>
    <tr>
      <th>start_aicc</th>
      <td><p>Numeric. Start value of <code>sigma</code> when optimizing the AICc. Note that this argument
is only applicable when <code>approach = "empirical"</code>, and <code>type</code> is either equal to
<code>"AICc_each_k"</code> or <code>"AICc_full"</code></p></td>
    </tr>
    <tr>
      <th>mu</th>
      <td><p>Numeric vector. (Optional) Containing the mean of the data generating distribution.
If <code>NULL</code> the expected values are estimated from the data. Note that this is only used
when <code>approach = "gaussian"</code>.</p></td>
    </tr>
    <tr>
      <th>cov_mat</th>
      <td><p>Numeric matrix. (Optional) Containing the covariance matrix of the data
generating distribution. <code>NULL</code> means it is estimated from the data if needed
(in the Gaussian approach).</p></td>
    </tr>
    <tr>
      <th>mincriterion</th>
      <td><p>Numeric value or vector where length of vector is the number of features in model.
Value is equal to 1 - alpha where alpha is the nominal level of the conditional
independence tests.
If it is a vector, this indicates which mincriterion to use
when conditioning on various numbers of features.</p></td>
    </tr>
    <tr>
      <th>minsplit</th>
      <td><p>Numeric value. Equal to the value that the sum of the left and right daughter nodes need to exceed.</p></td>
    </tr>
    <tr>
      <th>minbucket</th>
      <td><p>Numeric value. Equal to the minimum sum of weights in a terminal node.</p></td>
    </tr>
    <tr>
      <th>sample</th>
      <td><p>Boolean. If TRUE, then the method always samples <code>n_samples</code> from the leaf (with replacement).
If FALSE and the number of obs in the leaf is less than <code>n_samples</code>, the method will take all observations
in the leaf. If FALSE and the number of obs in the leaf is more than <code>n_samples</code>, the method will sample
<code>n_samples</code> (with replacement). This means that there will always be sampling in the leaf unless
<code>sample</code> = FALSE AND the number of obs in the node is less than <code>n_samples</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Object of class <code>c("shapr", "list")</code>. Contains the following items:</p><dl>
  <dt>dt</dt><dd><p>data.table</p></dd>
  <dt>model</dt><dd><p>Model object</p></dd>
  <dt>p</dt><dd><p>Numeric vector</p></dd>
  <dt>x_test</dt><dd><p>data.table</p></dd>

</dl>

<p>Note that the returned items <code>model</code>, <code>p</code> and <code>x_test</code> are mostly added due
to the implementation of <code>plot.shapr</code>. If you only want to look at the numerical results
it is sufficient to focus on <code>dt</code>. <code>dt</code> is a data.table where the number of rows equals
the number of observations you'd like to explain, and the number of columns equals <code>m +1</code>,
where <code>m</code> equals the total number of features in your model.</p>
<p>If <code>dt[i, j + 1] &gt; 0</code> it indicates that the j-th feature increased the prediction for
the i-th observation. Likewise, if <code>dt[i, j + 1] &lt; 0</code> it indicates that the j-th feature
decreased the prediction for the i-th observation. The magnitude of the value is also important
to notice. E.g. if <code>dt[i, k + 1]</code> and <code>dt[i, j + 1]</code> are greater than <code>0</code>,
where <code>j != k</code>, and <code>dt[i, k + 1]</code> &gt; <code>dt[i, j + 1]</code> this indicates that feature
<code>j</code> and <code>k</code> both increased the value of the prediction, but that the effect of the k-th
feature was larger than the j-th feature.</p>
<p>The first column in <code>dt</code>, called `none`, is the prediction value not assigned to any of the features
(\(\phi\)<sub>0</sub>).
It's equal for all observations and set by the user through the argument <code>prediction_zero</code>.
In theory this value should be the expected prediction without conditioning on any features.
Typically we set this value equal to the mean of the response variable in our training data, but other choices
such as the mean of the predictions in the training data are also reasonable.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The most important thing to notice is that <code>shapr</code> has implemented four different
approaches for estimating the conditional distributions of the data, namely <code>"empirical"</code>,
<code>"gaussian"</code>, <code>"copula"</code>, <code>"ctree"</code> and <code>"independence"</code>.
In addition, the user also has the option of combining the four approaches.
E.g., if you're in a situation where you have trained a model that consists of 10 features,
and you'd like to use the <code>"gaussian"</code> approach when you condition on a single feature,
the <code>"empirical"</code> approach if you condition on 2-5 features, and <code>"copula"</code> version
if you condition on more than 5 features this can be done by simply passing
<code>approach = c("gaussian", rep("empirical", 4), rep("copula", 5))</code>. If
<code>"approach[i]" = "gaussian"</code> means that you'd like to use the <code>"gaussian"</code> approach
when conditioning on <code>i</code> features.</p>
<p>For <code>approach="ctree"</code>, <code>n_samples</code> corresponds to the number of samples
from the leaf node (see an exception related to the <code>sample</code> argument).
For <code>approach="empirical"</code>, <code>n_samples</code> is  the \(K\) parameter in equations (14-15) of
Aas et al. (2021), i.e. the maximum number of observations (with largest weights) that is used, see also the
<code>w_threshold</code> argument.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Aas, K., Jullum, M., &amp; Løland, A. (2021). Explaining individual predictions when features are dependent:
  More accurate approximations to Shapley values. Artificial Intelligence, 298, 103502.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Camilla Lingjaerde, Nikolai Sellereite, Martin Jullum, Annabelle Redelmeier</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"MASS"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='co'># Load example data</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"Boston"</span>, package <span class='op'>=</span> <span class='st'>"MASS"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Split data into test- and training data</span></span>
<span class='r-in'>  <span class='va'>x_train</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>Boston</span>, <span class='op'>-</span><span class='fl'>3</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>x_test</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='va'>Boston</span>, <span class='fl'>3</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Fit a linear model</span></span>
<span class='r-in'>  <span class='va'>model</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>medv</span> <span class='op'>~</span> <span class='va'>lstat</span> <span class='op'>+</span> <span class='va'>rm</span> <span class='op'>+</span> <span class='va'>dis</span> <span class='op'>+</span> <span class='va'>indus</span>, data <span class='op'>=</span> <span class='va'>x_train</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Create an explainer object</span></span>
<span class='r-in'>  <span class='va'>explainer</span> <span class='op'>&lt;-</span> <span class='fu'><a href='shapr.html'>shapr</a></span><span class='op'>(</span><span class='va'>x_train</span>, <span class='va'>model</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Explain predictions</span></span>
<span class='r-in'>  <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>x_train</span><span class='op'>$</span><span class='va'>medv</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Empirical approach</span></span>
<span class='r-in'>  <span class='va'>explain1</span> <span class='op'>&lt;-</span> <span class='fu'>explain</span><span class='op'>(</span><span class='va'>x_test</span>, <span class='va'>explainer</span>,</span>
<span class='r-in'>    approach <span class='op'>=</span> <span class='st'>"empirical"</span>,</span>
<span class='r-in'>    prediction_zero <span class='op'>=</span> <span class='va'>p</span>, n_samples <span class='op'>=</span> <span class='fl'>1e2</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Gaussian approach</span></span>
<span class='r-in'>  <span class='va'>explain2</span> <span class='op'>&lt;-</span> <span class='fu'>explain</span><span class='op'>(</span><span class='va'>x_test</span>, <span class='va'>explainer</span>,</span>
<span class='r-in'>    approach <span class='op'>=</span> <span class='st'>"gaussian"</span>,</span>
<span class='r-in'>    prediction_zero <span class='op'>=</span> <span class='va'>p</span>, n_samples <span class='op'>=</span> <span class='fl'>1e2</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Gaussian copula approach</span></span>
<span class='r-in'>  <span class='va'>explain3</span> <span class='op'>&lt;-</span> <span class='fu'>explain</span><span class='op'>(</span><span class='va'>x_test</span>, <span class='va'>explainer</span>,</span>
<span class='r-in'>    approach <span class='op'>=</span> <span class='st'>"copula"</span>,</span>
<span class='r-in'>    prediction_zero <span class='op'>=</span> <span class='va'>p</span>, n_samples <span class='op'>=</span> <span class='fl'>1e2</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># ctree approach</span></span>
<span class='r-in'>  <span class='va'>explain4</span> <span class='op'>&lt;-</span> <span class='fu'>explain</span><span class='op'>(</span><span class='va'>x_test</span>, <span class='va'>explainer</span>,</span>
<span class='r-in'>    approach <span class='op'>=</span> <span class='st'>"ctree"</span>,</span>
<span class='r-in'>    prediction_zero <span class='op'>=</span> <span class='va'>p</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Combined approach</span></span>
<span class='r-in'>  <span class='va'>approach</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"gaussian"</span>, <span class='st'>"gaussian"</span>, <span class='st'>"empirical"</span>, <span class='st'>"empirical"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>explain5</span> <span class='op'>&lt;-</span> <span class='fu'>explain</span><span class='op'>(</span><span class='va'>x_test</span>, <span class='va'>explainer</span>,</span>
<span class='r-in'>    approach <span class='op'>=</span> <span class='va'>approach</span>,</span>
<span class='r-in'>    prediction_zero <span class='op'>=</span> <span class='va'>p</span>, n_samples <span class='op'>=</span> <span class='fl'>1e2</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Print the Shapley values</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>explain1</span><span class='op'>$</span><span class='va'>dt</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Plot the results</span></span>
<span class='r-in'>  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"ggplot2"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>explain1</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'></span>
<span class='r-in'>  <span class='co'># Group-wise explanations</span></span>
<span class='r-in'>  <span class='va'>group</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>A <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"lstat"</span>, <span class='st'>"rm"</span><span class='op'>)</span>, B <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"dis"</span>, <span class='st'>"indus"</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>explainer_group</span> <span class='op'>&lt;-</span> <span class='fu'><a href='shapr.html'>shapr</a></span><span class='op'>(</span><span class='va'>x_train</span>, <span class='va'>model</span>, group <span class='op'>=</span> <span class='va'>group</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>explain_groups</span> <span class='op'>&lt;-</span> <span class='fu'>explain</span><span class='op'>(</span></span>
<span class='r-in'>    <span class='va'>x_test</span>,</span>
<span class='r-in'>    <span class='va'>explainer_group</span>,</span>
<span class='r-in'>    approach <span class='op'>=</span> <span class='st'>"empirical"</span>,</span>
<span class='r-in'>    prediction_zero <span class='op'>=</span> <span class='va'>p</span>,</span>
<span class='r-in'>    n_samples <span class='op'>=</span> <span class='fl'>1e2</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>explain_groups</span><span class='op'>$</span><span class='va'>dt</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>        none    lstat        rm       dis       indus</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 1: 22.55229 4.936125  4.227149 0.9360181 -0.80703737</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 2: 22.55229 4.319264  2.689601 1.1058710 -0.42851521</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 3: 22.55229 3.821546 -1.891280 1.1444728  0.08623941</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Success with message:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> The columns(s) crim, zn, chas, nox, age, rad, tax, ptratio, black, medv is not used by the model and thus removed from the data.</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>        none        A         B</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 1: 22.55229 8.718123 0.5741309</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 2: 22.55229 6.838269 0.8479526</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> 3: 22.55229 1.842581 1.3183971</span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Nikolai Sellereite, Martin Jullum, Annabelle Redelmeier, Norsk Regnesentral.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


